function renderSignUp(parent) {
  client.page = "signup";
  document.querySelector("#wrapper").innerHTML = "";

  const container = document.createElement("div");
  container.id = "signUpContainer";
  parent.appendChild(container);

  container.innerHTML = `
    <div id="signUpTextContainer">
        <p>Welcome to SpotYa, <br>Create an account</p>
        <p>Already have an account? <span id = "logInLink"> Sign in here</span></p>
    </div>
    <div id="signUpInputContainer">
        <div id="userNameContainerSignUp">
            <p>Username</p>
            <input type="text" id="userNameInputSignUp">
        </div>
        <div id="passwordInputContainerSignUp">
            <p>Password</p>
            <div class="passwordContainer">
                <input type="password" id="passwordInputSignUp" class="passwordInputField">
                <span class="toggleIcon">
                    <svg class="icon" width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.178 6.81016C19.1514 6.74922 18.5014 5.30781 17.0499 3.85625C15.703 2.51094 13.3889 0.90625 9.99989 0.90625C6.61082 0.90625 4.29676 2.51094 2.94989 3.85625C1.49832 5.30781 0.848323 6.74687 0.821761 6.81016C0.795052 6.87016 0.78125 6.9351 0.78125 7.00078C0.78125 7.06646 0.795052 7.1314 0.821761 7.19141C0.848323 7.25156 1.49832 8.69297 2.94989 10.1445C4.29676 11.4898 6.61082 13.0938 9.99989 13.0938C13.3889 13.0938 15.703 11.4898 17.0499 10.1445C18.5014 8.69297 19.1514 7.25391 19.178 7.19141C19.2047 7.1314 19.2185 7.06646 19.2185 7.00078C19.2185 6.9351 19.2047 6.87016 19.178 6.81016ZM9.99989 12.1562C7.54832 12.1562 5.4077 11.2641 3.6366 9.50547C2.89419 8.76759 2.26593 7.92315 1.77254 7C2.2658 6.077 2.89408 5.2328 3.6366 4.49531C5.4077 2.73594 7.54832 1.84375 9.99989 1.84375C12.4514 1.84375 14.5921 2.73594 16.3632 4.49531C17.1057 5.2328 17.734 6.077 18.2272 7C17.7296 7.95391 15.2343 12.1562 9.99989 12.1562ZM9.99989 3.40625C9.28911 3.40625 8.5943 3.61702 8.00331 4.01191C7.41232 4.40679 6.9517 4.96806 6.67969 5.62473C6.40769 6.2814 6.33652 7.00399 6.47519 7.70111C6.61385 8.39822 6.95613 9.03857 7.45872 9.54117C7.96132 10.0438 8.60166 10.386 9.29878 10.5247C9.9959 10.6634 10.7185 10.5922 11.3752 10.3202C12.0318 10.0482 12.5931 9.58757 12.988 8.99658C13.3829 8.40559 13.5936 7.71078 13.5936 7C13.5924 6.04726 13.2134 5.1339 12.5397 4.46021C11.866 3.78651 10.9526 3.40749 9.99989 3.40625ZM9.99989 9.65625C9.47453 9.65625 8.96097 9.50046 8.52415 9.20859C8.08733 8.91672 7.74688 8.50187 7.54583 8.0165C7.34479 7.53114 7.29218 6.99705 7.39468 6.48179C7.49717 5.96653 7.75015 5.49323 8.12163 5.12175C8.49312 4.75026 8.96642 4.49728 9.48168 4.39479C9.99694 4.2923 10.531 4.3449 11.0164 4.54595C11.5018 4.74699 11.9166 5.08745 12.2085 5.52427C12.5003 5.96108 12.6561 6.47464 12.6561 7C12.6561 7.70448 12.3763 8.38011 11.8781 8.87825C11.38 9.3764 10.7044 9.65625 9.99989 9.65625Z" fill="black"/>
                    </svg>
                </span>
            </div>
        </div>
        <div id="confirmPasswordInputContainerSignUp">
            <p>Confirm password</p>
            <div class="passwordContainer">
                <input type="password" id="confirmPasswordInputSignUp" class="passwordInputField">
                <span class="toggleIcon">
                    <svg class="icon" width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M19.178 6.81016C19.1514 6.74922 18.5014 5.30781 17.0499 3.85625C15.703 2.51094 13.3889 0.90625 9.99989 0.90625C6.61082 0.90625 4.29676 2.51094 2.94989 3.85625C1.49832 5.30781 0.848323 6.74687 0.821761 6.81016C0.795052 6.87016 0.78125 6.9351 0.78125 7.00078C0.78125 7.06646 0.795052 7.1314 0.821761 7.19141C0.848323 7.25156 1.49832 8.69297 2.94989 10.1445C4.29676 11.4898 6.61082 13.0938 9.99989 13.0938C13.3889 13.0938 15.703 11.4898 17.0499 10.1445C18.5014 8.69297 19.1514 7.25391 19.178 7.19141C19.2047 7.1314 19.2185 7.06646 19.2185 7.00078C19.2185 6.9351 19.2047 6.87016 19.178 6.81016ZM9.99989 12.1562C7.54832 12.1562 5.4077 11.2641 3.6366 9.50547C2.89419 8.76759 2.26593 7.92315 1.77254 7C2.2658 6.077 2.89408 5.2328 3.6366 4.49531C5.4077 2.73594 7.54832 1.84375 9.99989 1.84375C12.4514 1.84375 14.5921 2.73594 16.3632 4.49531C17.1057 5.2328 17.734 6.077 18.2272 7C17.7296 7.95391 15.2343 12.1562 9.99989 12.1562ZM9.99989 3.40625C9.28911 3.40625 8.5943 3.61702 8.00331 4.01191C7.41232 4.40679 6.9517 4.96806 6.67969 5.62473C6.40769 6.2814 6.33652 7.00399 6.47519 7.70111C6.61385 8.39822 6.95613 9.03857 7.45872 9.54117C7.96132 10.0438 8.60166 10.386 9.29878 10.5247C9.9959 10.6634 10.7185 10.5922 11.3752 10.3202C12.0318 10.0482 12.5931 9.58757 12.988 8.99658C13.3829 8.40559 13.5936 7.71078 13.5936 7C13.5924 6.04726 13.2134 5.1339 12.5397 4.46021C11.866 3.78651 10.9526 3.40749 9.99989 3.40625ZM9.99989 9.65625C9.47453 9.65625 8.96097 9.50046 8.52415 9.20859C8.08733 8.91672 7.74688 8.50187 7.54583 8.0165C7.34479 7.53114 7.29218 6.99705 7.39468 6.48179C7.49717 5.96653 7.75015 5.49323 8.12163 5.12175C8.49312 4.75026 8.96642 4.49728 9.48168 4.39479C9.99694 4.2923 10.531 4.3449 11.0164 4.54595C11.5018 4.74699 11.9166 5.08745 12.2085 5.52427C12.5003 5.96108 12.6561 6.47464 12.6561 7C12.6561 7.70448 12.3763 8.38011 11.8781 8.87825C11.38 9.3764 10.7044 9.65625 9.99989 9.65625Z" fill="black"/>
                    </svg>
                </span>
                <div id="validationContainer">
                    <p id="passwordValidation"></p>
                </div>
            </div>
        </div>
    </div>
    <button id="signUpButton">Sign up</button>`;

  document.querySelector("#logInLink").addEventListener("click", () => {
    renderSignIn(document.querySelector("#wrapper"));
  });

  //Toggle password icon and change the input type from "text" to "password" and vice versa.
  const passwordInputs = document.getElementsByClassName("passwordInputField");
  const toggleIcons = document.getElementsByClassName("icon");

  for (let i = 0; i < toggleIcons.length; i++) {
    toggleIcons[i].addEventListener("click", function () {
      const passwordInput = passwordInputs[i];

      if (passwordInput.type === "password") {
        passwordInput.type = "text";

        toggleIcons[
          i
        ].innerHTML = `<svg width="18" height="15" viewBox="0 0 18 15" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M3.31551 0.125187C3.2297 0.0455361 3.11718 0.000882775 3.0001 1.29499e-05C2.88302 -0.000856876 2.76986 0.0421198 2.68287 0.120487C2.59588 0.198854 2.54137 0.306938 2.53006 0.423473C2.51875 0.540008 2.55146 0.656556 2.62176 0.750187L4.25301 2.54706C1.34051 4.258 0.0944172 7.00019 0.040511 7.12284C0.0138019 7.18285 0 7.24779 0 7.31347C0 7.37915 0.0138019 7.44409 0.040511 7.50409C0.0670735 7.56425 0.717073 9.00566 2.16864 10.4572C3.51551 11.8025 5.82957 13.4064 9.21864 13.4064C10.6352 13.4151 12.0367 13.1151 13.3257 12.5275L15.1225 14.5033C15.2063 14.5953 15.3231 14.6503 15.4473 14.6561C15.5716 14.662 15.693 14.6183 15.785 14.5346C15.877 14.4509 15.932 14.334 15.9379 14.2098C15.9437 14.0855 15.9 13.9641 15.8163 13.8721L3.31551 0.125187ZM7.11395 5.69706L10.6296 9.56581C10.1017 9.89563 9.47486 10.0296 8.85832 9.94441C8.24178 9.8592 7.67475 9.56019 7.25617 9.09957C6.83759 8.63894 6.59405 8.04596 6.56806 7.4241C6.54207 6.80225 6.73527 6.19101 7.11395 5.69706ZM9.21864 12.4689C6.76707 12.4689 4.62645 11.5768 2.85535 9.81816C2.11276 9.08043 1.48448 8.23596 0.991292 7.31269C1.32645 6.67206 2.5616 4.56425 4.89754 3.25722L6.47567 4.99237C5.9138 5.65817 5.61292 6.5054 5.629 7.37644C5.64508 8.24748 5.97702 9.08303 6.56307 9.72764C7.14912 10.3722 7.94937 10.782 8.81495 10.8807C9.68053 10.9794 10.5525 10.7604 11.2686 10.2643L12.66 11.7955C11.5692 12.2468 10.3992 12.4758 9.21864 12.4689ZM9.71864 4.70331C9.59649 4.68 9.48861 4.60912 9.41872 4.50627C9.34884 4.40342 9.32267 4.27702 9.34598 4.15487C9.36929 4.03273 9.44017 3.92485 9.54302 3.85496C9.64587 3.78507 9.77227 3.75891 9.89442 3.78222C10.6577 3.9305 11.3527 4.32148 11.8757 4.89686C12.3987 5.47225 12.7218 6.20124 12.7968 6.97519C12.8025 7.03649 12.796 7.09831 12.7778 7.15713C12.7596 7.21595 12.73 7.2706 12.6907 7.31798C12.6514 7.36535 12.6031 7.40451 12.5487 7.43323C12.4942 7.46195 12.4346 7.47966 12.3733 7.48534H12.3296C12.2124 7.48584 12.0992 7.44239 12.0124 7.36358C11.9257 7.28476 11.8716 7.17629 11.8608 7.05956C11.8051 6.4885 11.5665 5.95068 11.1805 5.52613C10.7946 5.10159 10.2818 4.813 9.71864 4.70331ZM18.3968 7.50409C18.3647 7.57597 17.5866 9.30097 15.8296 10.8728C15.784 10.9156 15.7303 10.9487 15.6718 10.9704C15.6132 10.9921 15.5509 11.0019 15.4884 10.9991C15.426 10.9964 15.3648 10.9812 15.3084 10.9545C15.2519 10.9277 15.2014 10.89 15.1597 10.8434C15.1181 10.7969 15.0861 10.7425 15.0658 10.6834C15.0455 10.6243 15.0371 10.5618 15.0413 10.4995C15.0455 10.4371 15.0621 10.3763 15.0901 10.3205C15.1182 10.2646 15.1571 10.215 15.2046 10.1744C16.1128 9.35839 16.8713 8.38991 17.446 7.31269C16.9527 6.38947 16.3244 5.54502 15.5819 4.80722C13.8108 3.04862 11.6702 2.15644 9.21864 2.15644C8.70331 2.15575 8.18881 2.19756 7.68035 2.28144C7.61913 2.29298 7.55622 2.2922 7.49531 2.27914C7.43439 2.26609 7.37669 2.24103 7.32557 2.20541C7.27445 2.1698 7.23094 2.12435 7.19759 2.07173C7.16424 2.01911 7.14172 1.96037 7.13133 1.89894C7.12095 1.83751 7.12291 1.77463 7.13711 1.71397C7.15131 1.65331 7.17746 1.59608 7.21403 1.54565C7.2506 1.49521 7.29685 1.45257 7.35009 1.42021C7.40334 1.38786 7.46249 1.36644 7.5241 1.35722C8.08414 1.26421 8.65093 1.21795 9.21864 1.21894C12.6077 1.21894 14.9218 2.82362 16.2686 4.16894C17.7202 5.6205 18.3702 7.05956 18.3968 7.12284C18.4235 7.18285 18.4373 7.24779 18.4373 7.31347C18.4373 7.37915 18.4235 7.44409 18.3968 7.50409Z" fill="black"/>
                </svg>
                `;
      } else {
        passwordInput.type = "password";

        toggleIcons[
          i
        ].innerHTML = `<svg width="20" height="14" viewBox="0 0 20 14" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M19.178 6.81016C19.1514 6.74922 18.5014 5.30781 17.0499 3.85625C15.703 2.51094 13.3889 0.90625 9.99989 0.90625C6.61082 0.90625 4.29676 2.51094 2.94989 3.85625C1.49832 5.30781 0.848323 6.74687 0.821761 6.81016C0.795052 6.87016 0.78125 6.9351 0.78125 7.00078C0.78125 7.06646 0.795052 7.1314 0.821761 7.19141C0.848323 7.25156 1.49832 8.69297 2.94989 10.1445C4.29676 11.4898 6.61082 13.0938 9.99989 13.0938C13.3889 13.0938 15.703 11.4898 17.0499 10.1445C18.5014 8.69297 19.1514 7.25391 19.178 7.19141C19.2047 7.1314 19.2185 7.06646 19.2185 7.00078C19.2185 6.9351 19.2047 6.87016 19.178 6.81016ZM9.99989 12.1562C7.54832 12.1562 5.4077 11.2641 3.6366 9.50547C2.89419 8.76759 2.26593 7.92315 1.77254 7C2.2658 6.077 2.89408 5.2328 3.6366 4.49531C5.4077 2.73594 7.54832 1.84375 9.99989 1.84375C12.4514 1.84375 14.5921 2.73594 16.3632 4.49531C17.1057 5.2328 17.734 6.077 18.2272 7C17.7296 7.95391 15.2343 12.1562 9.99989 12.1562ZM9.99989 3.40625C9.28911 3.40625 8.5943 3.61702 8.00331 4.01191C7.41232 4.40679 6.9517 4.96806 6.67969 5.62473C6.40769 6.2814 6.33652 7.00399 6.47519 7.70111C6.61385 8.39822 6.95613 9.03857 7.45872 9.54117C7.96132 10.0438 8.60166 10.386 9.29878 10.5247C9.9959 10.6634 10.7185 10.5922 11.3752 10.3202C12.0318 10.0482 12.5931 9.58757 12.988 8.99658C13.3829 8.40559 13.5936 7.71078 13.5936 7C13.5924 6.04726 13.2134 5.1339 12.5397 4.46021C11.866 3.78651 10.9526 3.40749 9.99989 3.40625ZM9.99989 9.65625C9.47453 9.65625 8.96097 9.50046 8.52415 9.20859C8.08733 8.91672 7.74688 8.50187 7.54583 8.0165C7.34479 7.53114 7.29218 6.99705 7.39468 6.48179C7.49717 5.96653 7.75015 5.49323 8.12163 5.12175C8.49312 4.75026 8.96642 4.49728 9.48168 4.39479C9.99694 4.2923 10.531 4.3449 11.0164 4.54595C11.5018 4.74699 11.9166 5.08745 12.2085 5.52427C12.5003 5.96108 12.6561 6.47464 12.6561 7C12.6561 7.70448 12.3763 8.38011 11.8781 8.87825C11.38 9.3764 10.7044 9.65625 9.99989 9.65625Z" fill="black"/>
                </svg>
                `;
      }
    });
  }

  const confirmPasswordInput = document.getElementById(
    "confirmPasswordInputSignUp"
  );

  confirmPasswordInput.addEventListener("keyup", () => {
    const firstPassword = document.getElementById("passwordInputSignUp").value;
    const secondPassword = document.getElementById(
      "confirmPasswordInputSignUp"
    ).value;

    validatePassword(firstPassword, secondPassword);

    console.log(`first: ${firstPassword}, second:${secondPassword}`);
  });

  const signUp = document.getElementById("signUpButton");
  signUp.addEventListener("click", async () => {
    const username = document.getElementById("userNameInputSignUp").value;
    const firstPassword = document.getElementById("passwordInputSignUp").value;
    const secondPassword = document.getElementById(
      "confirmPasswordInputSignUp"
    ).value;

    const password = validatePassword(firstPassword, secondPassword);

    if (password) {
      await signUp(username, password);
    } else {
      alert("Password validation failed.");
    }
  });
}

async function singUp(usernameInput, passwordInput) {
  try {
    const response = await fetch("http://localhost:8888/register/", {
      method: "POST",
      headers: {
        "Content-Type": "application/json",
      },
      body: JSON.stringify({
        username: usernameInput,
        password: passwordInput,
      }),
    });

    if (response.ok) {
      const data = await response.json();
      alert(data.message);
      localStorage.setItem("authKey", data.key);
      window.location.href = "../gameList/gameList.html";
    } else if (response.status === 409) {
      const error = await response.json();
      alert(error.error);
    } else if (response.status === 400) {
      const error = await response.json();
      alert(error.error);
    } else {
      alert("Internal server error, plase try again later");
    }
  } catch {
    alert("An error occured. Please check your connection");
  }
}

function validatePassword(first, second) {
  const message = document.getElementById("passwordValidation");
  const messageContainer = document.getElementById("validationContainer");
  let password = null;

  if (first != second) {
    message.innerHTML = `Passwords do not match`;
    message.style.color = "red";
    messageContainer.style.backgroundColor = "rgba(255,0,0,0.3)";
    console.log("Passwords do not match");
  } else if (first === second) {
    message.innerHTML = `Passwords match`;
    message.style.color = "green";
    messageContainer.style.backgroundColor = "rgba(0,128,0,0.3)";

    password = second;

    console.log("passwords match");
  }

  return password;
}
